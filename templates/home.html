{% extends 'base.html' %}
{% block content %}
<div class="header">
    <div class="state" id="state">{{ state }}</div>
    <div class="countdown" id="countdown">0</div>
</div>
<div class="main">
    <div class="outer-margin"></div>
    <div class="team" id="legion">
        <div class="team-header">Legion</div>
        {% for index in range( 3 ) %}
        <div class="player" id="legion-{{ index }}">
            <div class="player-name">{% if legion|length > index %}{{ legion[ index ] }}{% else %}Unnamed Player{% endif %}</div>
            <div class="selected-hero"></div>
        </div>
        {% endfor %}
    </div>
    <div class="inner-margin"></div>
    <div class="heroes">
        {% for stat, stat_name in [ ( "agi", "Agility" ), ( "int", "Intelligence" ), ( "str", "Strength" ) ] %}
        <div class="stat-block" id="{{ stat }}-heroes">
            <div class="hero-list-header">{{ stat_name }}</div>
            <div class="hero-block">
                {% for index in range( 8 ) %}
                <div class="hero" id="{{ stat }}-{{ index }}">
                    <img class="hero-image" src="https://stats.projectkongor.com/images/{{ heroes[ stat ][ index ].icon }}/icon_128.jpg"/>
                    <div class="hero-name">{{ heroes[ stat ][ index ].name }}</div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endfor %}
    </div>
    <div class="inner-margin"></div>
    <div class="team" id="hellbourne">
        <div class="team-header">Hellbourne</div>
        {% for index in range( 3 ) %}
        <div class="player" id="hellbourne-{{ index }}">
            <div class="player-name">{% if hellbourne|length > index %}{{ hellbourne[ index ] }}{% else %}Unnamed Player{% endif %}</div>
            <div class="selected-hero"></div>
        </div>
        {% endfor %}
    </div>
    <div class="outer-margin"></div>
</div>
<div class="controls">
    <button onClick="startDraft()">Start Draft</button>
</div>

<script type="text/javascript">
    "use strict";

    var socketio = io();

    const onStateChanged = ( state ) => {
        console.log( "changing state" );
        let stateLabel = document.getElementById( "state" );
        stateLabel.innerHTML = state;
    };
    socketio.on( "state-changed", onStateChanged );

    let timer;
    const onSetTimer = ( seconds ) => {
        console.log( "setting timer" );
        let countdownLabel = document.getElementById( "countdown" );
        countdownLabel.innerHTML = seconds;
        clearInterval( timer );
        if( seconds == 0 ) return;
        timer = setInterval( () => {
            --seconds;
            countdownLabel.innerHTML = seconds;
            if( seconds == 0 )
                clearInterval( timer );
        }, 1000 );
    };
    socketio.on( "set-timer", onSetTimer );

    const onUpdateHero = ( data ) => {
        console.log( `updating hero ${ data.stat }-${ data.index }` );
        let heroDiv = document.getElementById( `${ data.stat }-${ data.index }` );
        let nameLabel = heroDiv.getElementsByClassName( "hero-name" )[ 0 ];
        nameLabel.innerHTML = data.hero.name;
        let image = heroDiv.getElementsByClassName( "hero-image" )[ 0 ];
        image.src = `https://stats.projectkongor.com/images/${ data.hero.icon }/icon_128.jpg`;
    };
    socketio.on( "update-hero", onUpdateHero );

    const onPlayers = ( players ) => {
        console.log( "updating players" );
        let playersList = document.getElementById( "players" );
        playersList.innerHTML = "";
        players.forEach( ( player ) =>
        {
            playersList.innerHTML += `<li>${player.name}</li>`;
        } );
    };
    socketio.on( "players", onPlayers );

    const onLegion = ( legion ) => {
        console.log( "updating legion" );
        let legionList = document.getElementById( "legion" );
    };
    socketio.on( "legion", onLegion );

    const onHellbourne = ( hellbourne ) => {
        console.log( "updating hellbourne" );
        let hellbourneList = document.getElementById( "hellbourne" );
    };
    socketio.on( "hellbourne", onHellbourne );

    const startDraft = () => {
        socketio.emit( "start-draft" );
    };
</script>
{% endblock %}
