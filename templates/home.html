{% extends 'base.html' %}
{% block content %}
<div class="header">
    <label class="state" id="state">{{ state }}</label>
    <label class="countdown" id="countdown">0</label>
</div>
<div class="main">
    <div class="outer-margin"></div>
    <div class="team" id="legion">
        <div class="team-header">Legion</div>
        {% for index in range( 3 ) %}
        <div class="player" id="legion-{{ index }}">
            <label class="player-name">{% if legion|length > index %}{{ legion[ index ] }}{% else %}Unnamed Player{% endif %}</label>
            <div class="selected-hero"></div>
        </div>
        {% endfor %}
    </div>
    <div class="inner-margin"></div>
    <div class="heroes">
        {% for stat, stat_name in [ ( "agi", "Agility" ), ( "int", "Intelligence" ), ( "str", "Strength" ) ] %}
        <div class="stat-block" id="{{ stat }}-heroes">
            <div class="hero-list-header">{{ stat_name }}</div>
            <div class="hero-block">
                {% for index in range( 8 ) %}
                <div class="hero" id="{{ stat }}-{{ index }}">
                    <img class="hero-image" src="https://stats.projectkongor.com/images/{{ heroes[ stat ][ index ].icon }}/icon_128.jpg"/>
                    <label class="hero-name">{{ heroes[ stat ][ index ].name }}</label>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endfor %}
    </div>
    <div class="inner-margin"></div>
    <div class="team" id="hellbourne">
        <div class="team-header">Hellbourne</div>
        {% for index in range( 3 ) %}
        <div class="player" id="hellbourne-{{ index }}">
            <label class="player-name">{% if hellbourne|length > index %}{{ hellbourne[ index ] }}{% else %}Unnamed Player{% endif %}</label>
            <div class="selected-hero"></div>
        </div>
        {% endfor %}
    </div>
    <div class="outer-margin"></div>
</div>
<div class="controls">
    <button onClick="startDraft()">Start Draft</button>
</div>

<script type="text/javascript">
    var socketio = io();

    const onStateChanged = ( state ) => {
        console.log( "updating state" );
        stateLabel = document.getElementById( "state" );
        // try value instead of innerHTML
        stateLabel.innerHTML = state;
    };
    socketio.on( "state-changed", onStateChanged );

    const onTimerChanged = ( seconds ) => {
        console.log( "updating timer" );
        countdownLabel = document.getElementById( "countdown" );
        // try value instead of innerHTML
        countdownLabel.innerHTML = seconds;
    };
    socketio.on( "set-timer", onTimerChanged );

    const onPlayers = ( players ) => {
        console.log( "updating players" );
        playersList = document.getElementById( "players" );
        playersList.innerHTML = "";
        players.forEach( ( player ) =>
        {
            playersList.innerHTML += `<li>${player.name}</li>`;
        } );
    };
    socketio.on( "players", onPlayers );

    const onLegion = ( legion ) => {
        console.log( "updating legion" );
        legionList = document.getElementById( "legion" );
    };
    socketio.on( "legion", onLegion );

    const onHellbourne = ( hellbourne ) => {
        console.log( "updating hellbourne" );
        hellbourneList = document.getElementById( "hellbourne" );
    };
    socketio.on( "hellbourne", onHellbourne );

    const onAgiHeroes = ( agiHeroes ) => {
        console.log( "updating agi heroes" );
        agiHeroesList = document.getElementById( "agi-heroes" );
        agiHeroesList.innerHTML = "";
        agiHeroes.forEach( ( hero ) =>
        {
            agiHeroesList.innerHTML += `<li>${hero.name}</li>`;
        } );
    };
    socketio.on( "agi-heroes", onAgiHeroes );

    const onIntHeroes = ( intHeroes ) => {
        console.log( "updating int heroes" );
        intHeroesList = document.getElementById( "int-heroes" );
        intHeroesList.innerHTML = "";
        intHeroes.forEach( ( hero ) =>
        {
            intHeroesList.innerHTML += `<li>${hero.name}</li>`;
        } );
    };
    socketio.on( "int-heroes", onIntHeroes );

    const onStrHeroes = ( strHeroes ) => {
        console.log( "updating str heroes" );
        strHeroesList = document.getElementById( "str-heroes" );
        strHeroesList.innerHTML = "";
        strHeroes.forEach( ( hero ) =>
        {
            strHeroesList.innerHTML += `<li>${hero.name}</li>`;
        } );
    };
    socketio.on( "str-heroes", onStrHeroes );

    const startDraft = () => {
        socketio.emit( "start-draft" );
    };
</script>
{% endblock %}
